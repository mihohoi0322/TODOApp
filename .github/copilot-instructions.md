# TODO アプリ 要件定義

## 1. プロジェクト概要
VSCode + GitHub Copilot のワークショップ用デモアプリケーション。
シンプルなTODOリスト管理機能を提供する。

## 2. 技術スタック要件

### フロントエンド
- **フレームワーク**: React 19.2+ (最新安定版)
- **言語**: TypeScript 5.9+ (最新安定版)
- **ビルドツール**: Vite 6+ (最新版)
- **スタイリング**: CSS Modules または Tailwind CSS
- **状態管理**: React Hooks (useState, useEffect)
- **React機能**: React Compiler 対応 (最適化されたパフォーマンス)

### バックエンド
- **実行環境**: Node.js 24 LTS または Node.js 25+ (最新版)
- **言語**: TypeScript 5.9+
- **フレームワーク**: Express 5.1+ (最新版、LTSスケジュール対応)
- **データストレージ**: インメモリストレージ (開発用)
- **API設計**: RESTful API

### 開発環境
- **パッケージマネージャー**: npm (Node.js同梱) または pnpm 9+
- **リンター**: ESLint 9+
- **フォーマッター**: Prettier 3+
- **Git**: GitHub リポジトリ

## 3. 機能要件

### 3.1 タスク追加機能
- ユーザーはタスクのタイトルを入力してTODOリストに追加できる
- 入力フィールドとボタン(または Enter キー)で追加
- タスクには以下の属性を持つ:
  - `id`: 一意の識別子 (UUID)
  - `title`: タスクのタイトル (必須、文字列)
  - `completed`: 完了状態 (boolean、デフォルト: false)
  - `dueDate`: 期限日 (ISO 8601形式の日付、オプショナル)
  - `createdAt`: 作成日時 (ISO 8601形式)
  - `updatedAt`: 更新日時 (ISO 8601形式)

### 3.2 タスク削除機能
- 各タスクに削除ボタンを配置
- **削除時は確認ダイアログを表示** (誤操作防止)
  - 「このタスクを削除してもよろしいですか?」
  - 「キャンセル」と「削除」ボタンを提供
- 確認後、タスクをリストから削除

### 3.3 タスク完了/未完了切り替え
- チェックボックスまたはクリックでタスクの完了状態を切り替え
- 完了したタスクは視覚的に区別 (取り消し線、グレーアウトなど)

### 3.4 タスク一覧表示
- すべてのタスクをリスト形式で表示
- 作成日時の新しい順に表示 (降順)
- 完了/未完了の状態を視覚的に明確に表示

### 3.5 タスクページ分類機能
- **Today (今日)**: 期限が今日のタスクを表示
  - `dueDate` が今日の日付と一致するタスクのみ表示
  - 期限切れが近いことを視覚的に強調
- **InBox (受信箱)**: 期限が設定されていないタスクを表示
  - `dueDate` が `null` または未設定のタスクのみ表示
  - デフォルトの表示ページ
- **近日予定 (Upcoming)**: 期限が設定されているタスクを表示
  - `dueDate` が設定されているすべてのタスクを期限順に表示
  - 期限が近い順にソート (昇順)
  - 過去の期限切れタスクも含めて表示し、視覚的に区別
- ページ切り替えはナビゲーションメニューまたはタブで実現

### 3.6 タスク期限編集機能
- タスク作成時または編集時に期限を設定可能
- 日付ピッカーUIで直感的に日付選択
- 期限をクリアして InBox に戻すことも可能

### 3.7 データ永続化
- インメモリストレージでタスクデータを保存 (開発用)
- サーバー再起動時はデータがリセットされる

## 4. 非機能要件

### 4.1 ユーザビリティ
- シンプルで直感的なUI/UX
- レスポンシブデザイン (デスクトップとモバイルの両方に対応)
- ローディング状態の表示 (API通信中)
- エラーメッセージの適切な表示

### 4.2 パフォーマンス
- タスク追加/削除/更新のレスポンスタイム: 500ms以内
- 初回ロード時間: 2秒以内

### 4.3 コード品質
- TypeScriptの型安全性を最大限活用
- ESLintルールに準拠
- 適切なエラーハンドリング
- 環境変数で設定を管理 (.env ファイル)

### 4.4 セキュリティ
- XSS対策 (Reactのデフォルトエスケープを活用)
- CORS設定の適切な構成

## 5. プロジェクト構成定義

### 5.1 ディレクトリ構造
```
TODOApp/
├── client/                 # フロントエンド (React + Vite)
│   ├── src/
│   │   ├── components/    # Reactコンポーネント
│   │   ├── types/         # TypeScript型定義
│   │   ├── utils/         # ユーティリティ関数
│   │   ├── App.tsx        # メインコンポーネント
│   │   └── main.tsx       # エントリーポイント
│   ├── public/            # 静的ファイル
│   ├── index.html
│   ├── package.json
│   ├── tsconfig.json
│   └── vite.config.ts
│
├── server/                # バックエンド (Node.js + Express)
│   ├── src/
│   │   ├── routes/        # APIルート
│   │   ├── models/        # データモデル
│   │   ├── services/      # ビジネスロジック
│   │   ├── config/        # 設定ファイル
│   │   └── server.ts      # サーバーエントリーポイント
│   ├── package.json
│   └── tsconfig.json
│
├── .github/
│   └── copilot-instructions.md  # このファイル
├── .gitignore
├── README.md
└── .env.example           # 環境変数テンプレート
```

### 5.2 命名規則
- **ファイル名**: PascalCase (コンポーネント), camelCase (その他)
- **変数/関数**: camelCase
- **型/インターフェース**: PascalCase
- **定数**: UPPER_SNAKE_CASE
- **コンポーネント**: PascalCase、機能を表す名前

### 5.3 コミットメッセージ規約
- `feat:` 新機能追加
- `fix:` バグ修正
- `docs:` ドキュメント変更
- `style:` コードフォーマット
- `refactor:` リファクタリング
- `test:` テスト追加・修正
- `chore:` ビルド・設定変更

## 6. API仕様

### 6.1 エンドポイント

#### GET /api/todos
- **説明**: すべてのタスクを取得
- **クエリパラメータ**:
  - `filter`: タスクのフィルター (`today` | `inbox` | `upcoming` | `all`)
- **レスポンス**: 
  ```typescript
  {
    "todos": [
      {
        "id": "uuid",
        "title": "string",
        "completed": boolean,
        "dueDate": "ISO 8601 date string | null",
        "createdAt": "ISO 8601 string",
        "updatedAt": "ISO 8601 string"
      }
    ]
  }
  ```

#### POST /api/todos
- **説明**: 新しいタスクを作成
- **リクエストボディ**:
  ```typescript
  {
    "title": "string", // 必須
    "dueDate"?: "ISO 8601 date string" // オプショナル
  }
  ```
- **レスポンス**: 作成されたタスクオブジェクト

#### PUT /api/todos/:id
- **説明**: タスクを更新
- **リクエストボディ**:
  ```typescript
  {
    "title"?: "string",
    "completed"?: boolean,
    "dueDate"?: "ISO 8601 date string | null"
  }
  ```
- **レスポンス**: 更新されたタスクオブジェクト

#### DELETE /api/todos/:id
- **説明**: タスクを削除
- **レスポンス**: 
  ```typescript
  {
    "message": "Todo deleted successfully"
  }
  ```

### 6.2 エラーレスポンス
すべてのエラーは以下の形式で返す:
```typescript
{
  "error": "エラーメッセージ",
  "status": HTTPステータスコード
}
```

## 7. 実装の優先順位

### Phase 1: 基本セットアップ
1. プロジェクト構造作成
2. 依存関係のインストール
3. 環境変数設定

### Phase 2: バックエンドAPI
1. Express サーバー基本構成
2. インメモリストレージ実装
3. CRUD APIエンドポイント実装
4. エラーハンドリング

### Phase 3: フロントエンド基本機能
1. React + Vite セットアップ
2. ナビゲーション/タブUI (Today/InBox/近日予定)
3. タスク一覧表示
4. タスク追加機能 (期限設定含む)
5. タスク完了切り替え機能

### Phase 4: タスクフィルタリングとページ機能
1. Today ページ実装 (今日期限のタスク表示)
2. InBox ページ実装 (期限未設定のタスク表示)
3. 近日予定ページ実装 (期限順ソート)
4. 期限切れタスクの視覚的強調

### Phase 5: 削除機能と確認ダイアログ
1. 削除ボタン実装
2. **確認ダイアログコンポーネント作成**
3. 削除処理の実装

### Phase 6: UI/UX向上
1. スタイリング
2. 日付ピッカーコンポーネント
3. ローディング状態
4. エラー表示
5. レスポンシブ対応

## 9. テスト要件

### 9.1 Playwright MCP による自動テスト (必須)

**重要: コードを修正した後は、必ず Playwright MCP を使用してテストを実行すること。**

#### 9.1.1 テスト実行前の準備
1. サーバーを起動: `cd server && npm run dev`
2. クライアントを起動: `cd client && npm run dev`
3. アプリケーションが `http://localhost:3000` で動作していることを確認

#### 9.1.2 Playwright MCP テストシナリオ
以下のテストを順番に実行する:

1. **アプリケーション起動確認**
   - `http://localhost:3000` にナビゲート
   - "TODO アプリ" タイトルが表示されることを確認

2. **タスク追加テスト (期限なし)**
   - タスク入力欄に「テストタスク」を入力
   - 「追加」ボタンをクリック
   - タスクがリストに表示されることを確認

3. **タスク追加テスト (期限あり)**
   - タスク入力欄に「期限付きタスク」を入力
   - 日付入力欄に期限を設定
   - 「追加」ボタンをクリック
   - タスクがリストに表示されることを確認

4. **ナビゲーションテスト**
   - 「Today」タブをクリック → 今日期限のタスクのみ表示
   - 「InBox」タブをクリック → 期限未設定のタスクのみ表示
   - 「近日予定」タブをクリック → 期限付きタスクが表示

5. **タスク完了切り替えテスト**
   - タスクのチェックボックスをクリック
   - タスクに取り消し線が表示されることを確認
   - 再度クリックして未完了に戻ることを確認

6. **削除確認ダイアログテスト**
   - 削除ボタンをクリック
   - 確認ダイアログが表示されることを確認
   - 「キャンセル」をクリック → タスクが削除されないことを確認
   - 再度削除ボタンをクリック
   - 「削除」をクリック → タスクが削除されることを確認

#### 9.1.3 テスト実行タイミング
- **必須**: 以下の変更を行った後は必ずテストを実行
  - コンポーネントの修正
  - API エンドポイントの変更
  - スタイリングの変更
  - 状態管理ロジックの修正
  - 新機能の追加

### 9.2 手動テストシナリオ
- [ ] タスクを追加できる (期限あり/なし両方)
- [ ] タスクを完了/未完了に切り替えられる
- [ ] Today ページに今日期限のタスクのみ表示される
- [ ] InBox ページに期限未設定のタスクのみ表示される
- [ ] 近日予定ページに期限付きタスクが期限順に表示される
- [ ] 期限切れタスクが視覚的に区別される
- [ ] タスクの期限を編集できる
- [ ] 期限をクリアすると InBox に移動する
- [ ] 削除ボタンをクリックすると確認ダイアログが表示される
- [ ] 確認ダイアログで「キャンセル」を選択するとタスクが削除されない
- [ ] 確認ダイアログで「削除」を選択するとタスクが削除される
- [ ] 複数のタスクを同時に管理できる

## 10. ワークショップでの活用ポイント

### 10.1 GitHub Copilot の活用例
- コンポーネント作成時の自動補完
- API実装時の型定義自動生成
- 確認ダイアログのReactコンポーネント生成
- エラーハンドリングコードの提案
- インメモリストレージの実装

### 10.2 Instructions の活用
- この要件定義ファイルを参照してCopilotに指示
- 「削除ボタンを実装する際、確認ダイアログを表示する」などの要件を自動適用
- TypeScript/Reactの技術的要件に基づいたコード生成

### 10.3 デモシナリオ
1. 空のプロジェクトから開始
2. Copilotを使ってバックエンドAPI作成
3. Copilotを使ってフロントエンド作成
4. 確認ダイアログなどの細かい機能追加
5. 動作確認
