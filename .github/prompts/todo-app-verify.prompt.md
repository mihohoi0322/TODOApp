# TODOアプリ稼働確認

このプロンプトは、TODOアプリが正しくセットアップされ、動作していることを確認するためのものです。

**重要**: 各確認項目でエラーが発生した場合は、エラーを解決してから次の項目に進んでください。エラーが解決するまで修正を繰り返し、すべての確認項目が正常に動作することを確認してください。

## 確認したいこと

### 1. 依存関係のインストール確認
- `client/node_modules` が存在するか確認
- `server/node_modules` が存在するか確認
- インストールされていない場合は、両方のディレクトリで `npm install` を実行
- **エラーが発生した場合**: エラーメッセージを確認し、Node.jsのバージョンや権限の問題を解決してから再実行

### 2. サーバーの起動確認
- `server/` ディレクトリで `npm run dev` を実行できるか確認
- サーバーが http://localhost:5000 で起動しているか確認
- ヘルスチェックエンドポイント `/api/health` にアクセスして応答を確認
- **エラーが発生した場合**: ポート競合やTypeScriptエラーを解決してから再起動

### 3. クライアントの起動確認
- `client/` ディレクトリで `npm run dev` を実行できるか確認
- クライアントが http://localhost:3000 で起動しているか確認
- ブラウザでアクセスして「TODO アプリ」が表示されるか確認
- **エラーが発生した場合**: ビルドエラーや依存関係の問題を解決してから再起動

### 4. API通信の確認
- クライアントから `/api/health` エンドポイントにリクエストを送信できるか確認
- Viteのプロキシ設定が正しく動作しているか確認
- **エラーが発生した場合**: プロキシ設定やCORS設定を確認し、修正してから再テスト

### 5. TypeScriptのビルド確認
- `client/` で `npm run build` が成功するか確認
- `server/` で `npm run build` が成功するか確認
- ビルドエラーがないことを確認
- **エラーが発生した場合**: 型エラーや構文エラーを修正してから再ビルド

### 6. 環境変数の確認
- `.env` ファイルが存在するか確認（オプショナル）
- 存在しない場合は `.env.example` をコピーして作成
- **エラーが発生した場合**: 環境変数の形式や値を確認し、修正

### 7. Playwright MCPを使った自動動作確認（推奨）
- Playwright MCPを使用してブラウザの自動テストを実行
- アプリケーションが正しくレンダリングされているか確認
- UIコンポーネント（タイトル、ボタンなど）が存在するか確認
- ボタンのクリック動作など、基本的なインタラクションが動作するか確認
- **エラーが発生した場合**: テスト結果を確認し、該当する問題を修正してから再テスト

## 確認手順

**重要な原則**: 各ステップでエラーが発生した場合は、必ずエラーを解決してから次のステップに進んでください。エラーログを確認し、問題を特定し、修正を行い、再度確認を繰り返してください。

### Step 1: 依存関係のインストール
両方のディレクトリで依存関係がインストールされていることを確認し、必要に応じてインストール:
```bash
cd client
npm install

cd ../server
npm install
```
✅ **成功条件**: エラーなくインストールが完了し、`node_modules` ディレクトリが作成される
❌ **エラー時**: トラブルシューティングセクションを参照し、エラーを解決してから再実行

### Step 2: サーバーの起動テスト
サーバーを起動して、正常に動作することを確認:
```bash
cd server
npm run dev
```
✅ **成功条件**: `Server is running on http://localhost:5000` が表示される
❌ **エラー時**: エラーメッセージを確認し、ポート競合やコード修正を行ってから再起動

### Step 3: クライアントの起動テスト
別のターミナルでクライアントを起動して、正常に動作することを確認:
```bash
cd client
npm run dev
```
✅ **成功条件**: Viteの開発サーバーが起動し、`http://localhost:3000` でアクセス可能
❌ **エラー時**: ビルドエラーを修正し、依存関係を確認してから再起動

### Step 4: 動作確認
ブラウザで http://localhost:3000 を開いて以下を確認:
- 「TODO アプリ」のタイトルが表示される
- 「count is 0」ボタンが表示される
- ボタンをクリックするとカウントが増える

✅ **成功条件**: すべての要素が正常に表示され、動作する
❌ **エラー時**: ブラウザのコンソールでエラーを確認し、コードを修正してから再確認

### Step 5: APIエンドポイントの確認
ブラウザまたはcurlで http://localhost:5000/api/health にアクセス:
```bash
curl http://localhost:5000/api/health
```
期待されるレスポンス:
```json
{"status":"OK","message":"TODO API Server is running"}
```

✅ **成功条件**: 正しいJSONレスポンスが返される
❌ **エラー時**: サーバーログを確認し、エンドポイントの実装を修正してから再テスト

### Step 6: Playwright MCPを使った自動テスト（推奨）
Playwright MCPを使用して、ブラウザの自動テストを実行:

1. **ページのナビゲーション**: http://localhost:3000 にアクセス
2. **要素の存在確認**: 
   - `h1` タグに「TODO アプリ」が含まれているか確認
   - ボタンに「count is 0」が表示されているか確認
3. **インタラクションテスト**:
   - ボタンをクリック
   - カウントが「count is 1」に変わることを確認
4. **スクリーンショット取得**: 動作確認のため、画面キャプチャを保存

✅ **成功条件**: すべてのテストが成功し、UIが期待通りに動作する
❌ **エラー時**: 
  - Playwright MCPのエラーログを確認
  - 要素が見つからない場合は、セレクタやDOM構造を確認
  - タイムアウトエラーの場合は、アプリの起動を確認
  - 問題を修正してから再テスト

## トラブルシューティング

**基本原則**: エラーが発生したら、必ずエラーメッセージを読み、原因を特定し、修正してから再実行してください。問題が解決するまで繰り返し確認してください。

### 依存関係のインストールエラー
- Node.js のバージョンを確認（24 LTS または 25+ が必要）
  ```bash
  node --version
  ```
- `node_modules` を削除して再インストール
  ```bash
  rm -rf node_modules package-lock.json
  npm install
  ```
- **エラーが解決するまで**: 権限の問題やネットワークエラーを確認し、修正を繰り返す

### ポート競合エラー
- ポート3000または5000が既に使用されている場合は、プロセスを終了
  ```bash
  # Windowsの場合
  netstat -ano | findstr :5000
  taskkill /PID <PID> /F
  ```
- `.env` ファイルで別のポートを指定
- **エラーが解決するまで**: 使用中のプロセスを特定し、終了または別ポートを使用

### TypeScriptエラー
- `tsconfig.json` の設定を確認
- 型定義ファイル（`@types/*`）が正しくインストールされているか確認
- エラーメッセージの行番号を確認し、コードを修正
- **エラーが解決するまで**: 型エラーを一つずつ修正し、再ビルドを繰り返す

### プロキシが動作しない
- Viteの開発サーバーとExpressサーバーが両方起動しているか確認
- `vite.config.ts` のプロキシ設定を確認
- サーバーのCORS設定を確認
- **エラーが解決するまで**: 設定を修正し、両サーバーを再起動して確認

### ビルドエラー
- エラーログを詳細に読み、問題のあるファイルと行を特定
- 構文エラー、インポートエラー、型エラーを修正
- **エラーが解決するまで**: エラーを一つずつ修正し、`npm run build` を繰り返す

### Playwright MCPテストエラー
- **要素が見つからない**: 
  - DOM構造を確認し、正しいセレクタ（タグ名、クラス名、テキスト）を使用
  - アプリが完全にロードされるまで待機時間を調整
- **タイムアウトエラー**: 
  - クライアントとサーバーが両方起動していることを確認
  - ブラウザで手動アクセスして、アプリが動作しているか確認
- **インタラクションが失敗**: 
  - 要素が表示されているか、クリック可能な状態か確認
  - JavaScriptエラーがないかブラウザコンソールで確認
- **エラーが解決するまで**: テスト結果のスクリーンショットやエラーメッセージを確認し、問題を修正して再実行

## 次のステップ

稼働確認が完了したら、`.github/copilot-instructions.md` の要件定義に従って、以下の機能を実装:
1. TODOタスクのデータモデル作成
2. CRUD APIエンドポイントの実装
3. フロントエンドのUIコンポーネント作成
4. タスクの追加・削除・完了機能の実装
